# This is a Databricks asset bundle definition for dc_bikeshare.
# See https://docs.databricks.com/dev-tools/bundles/index.html for documentation.
bundle:
  name: dc_bikeshare
  uuid: 7eb02bd5-9ad3-47c4-ade2-a9c1d268cc4d

include:
  - resources/*.yml
  - resources/*/*.yml

variables:
  catalog:
    description: Unity Catalog to use
  bronze_schema:
    description: Schema for bronze layer
    default: bronze
  silver_schema:
    description: Schema for silver layer
    default: silver
  gold_schema:
    description: Schema for gold layer
    default: gold
  source_bucket:
    description: S3 bucket for raw data
  volume_name:
    description: Volume name for raw data landing zone
    default: raw_landing_zone

resources:
  jobs:
    bikeshare_etl:
      name: bikeshare_etl_${bundle.target}
      email_notifications:
        on_failure:
          - green.leek47@gmail.com
      tasks:
        - task_key: bronze
          notebook_task:
            notebook_path: ./src/bikeshare_bronze.py
            base_parameters:
              catalog: ${var.catalog}
              bronze_schema: ${var.bronze_schema}
              source_bucket: ${var.source_bucket}
              volume_name: ${var.volume_name}

        - task_key: silver
          depends_on:
            - task_key: bronze
          notebook_task:
            notebook_path: ./src/bikeshare_silver.py
            base_parameters:
              catalog: ${var.catalog}
              bronze_schema: ${var.bronze_schema}
              silver_schema: ${var.silver_schema}

        - task_key: gold
          depends_on:
            - task_key: silver
          notebook_task:
            notebook_path: ./src/bikeshare_gold.py
            base_parameters:
              catalog: ${var.catalog}
              silver_schema: ${var.silver_schema}
              gold_schema: ${var.gold_schema}

targets:
  dev:
    mode: development
    default: true
    workspace:
      host: https://dbc-b4813f44-2c67.cloud.databricks.com
    variables:
      catalog: dev_bikeshare
      source_bucket: s3://bikeshare-dc-data-dev

  staging:
    mode: production
    workspace:
      host: https://dbc-b9fdb8d4-ebaa.cloud.databricks.com
    variables:
      catalog: staging_bikeshare
      source_bucket: s3://bikeshare-dc-data-staging

  prod:
    mode: production
    workspace:
      host: https://dbc-1886d4dd-39a5.cloud.databricks.com
    variables:
      catalog: prod_bikeshare
      source_bucket: s3://bikeshare-dc-data
